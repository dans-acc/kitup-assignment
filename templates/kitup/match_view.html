{% extends 'kitup/base.html' %}

<!-- Overwrite the title of the page. -->
{% block title_block %}
Viewing Match
{% endblock %}

<!-- Overwrite the opening body tag. -->
{% block body_opening_tag %}
<body class=".kitup-padding-top-56px">
{% endblock %}

<!-- Overwrite the content block - display the match content. -->
{% block content_block %}

<!-- The page content. -->
<div class="container">
	
	<!-- Define the header row - the location, options and information. -->
	<div class="row align-items-center my-5">

		<!-- Google maps displays the location of the match. -->
		<div class="col-lg-7">
			<img class="img-fluid rounded mb-4 mb-lg-0" src="http://placehold.it/900x400" alt="">
		</div>

		<!-- Display information and options about the match. -->
		<div class="col-lg-5">

			<!-- General information about the match. -->
			<h1 class="font-weight-light">Daniels' Mad Gathering!</h1>
			<dl class="row">
				<dt class="font-weight-light col-sm-3">Sport:</dt>
				<dd class="col-sm-9">{{ match.sport.name }}</dd>
				
				<dt class="font-weight-light col-sm-3">Date:</dt>
				<dd class="col-sm-9">June, 6 10:20 until 11:20</dd>
				<dt class="font-weight-light col-sm-3">Location:</dt>
				<dd class="col-sm-9">35 Middleton Park, Brechin.</dd>
				
				<dt class="font-weight-light col-sm-3">Ages:</dt>
				<dd class="col-sm-9">{{ match.min_age }} to {{ match.max_age }}</dd>
				<dt class="font-weight-light col-sm-3">Min. Rating:</dt>
				<dd class="col-sm-9">{{ match.min_rating }}</dd>
				<dt class="font-weight-light col-sm-3">Private</dt>
				<dd class="col-sm-9">{{ match.private }}</dd>
			</dl>

			<!-- The match button options. -->
			<a class="btn btn-success" href="#" role="button">Requests</a>
			<a class="btn btn-dark" href="#" role="button">Edit</a>
			<a class="btn btn-dark" href="#" role="button">Disband</a>

		</div>
	</div>

	<!-- Display the players that have already joined the match. -->
	<hr>

	<!-- Displays the players that are participating in the match. -->
	<div class="row my-5">
		<div class="col-lg-12 text-center">
			<h3 class="font-weight-light">Match Participants</h3>
		</div>
	</div>

	<!-- Display the match participants. -->
	{% for participant in match_accepted_participants %}

		<!-- If we're displaying the first participant, open a new row -->
		{% if forloop.first %}<div class="row text-center">{% endif %}

		<!-- Generate a participant. -->
		<div class="col-lg-3 col-md-6 mb-4">
			<div class="card h-100">
				<img class="card-img-top" src="http://placehold.it/500x325">

				<!-- Display the information about the user. -->
				<div class="card-body">
					<h5 class="card-title font-weight-light">{{ participant.profile.user.username }}</h5>
					<p class="card-text">
						Rating: {{ participant.profile.rating }}
					</p>
				</div>

				<!-- Defines the options permissible to the user for that player. -->
				<div class="card-footer">

					<!-- Display appropriate options. -->
					{% if not user.is_authenticated or user_participant is None or not user_participant.accepted %}

						<!-- Not logged in, view the profile. -->
						<a class="btn btn-dark w-100" href="{% url 'kitup:user_view_profile' participant.profile.id %}" 
						role="button">View</a>

					{% else %}

						<!-- Display the regular options. -->
						<div class="row text-center">
							{% if match_is_in_past %}
								<div class="col pr-1">
									<a class="btn btn-success w-100" href="#" role="button">Rate</a>
								</div>
								<div class="col pl-1">
									<a class="btn btn-dark w-100" href="#" role="button">View</a>
								</div>
							{% else %}
								<div class="col">
									<a class="btn btn-dark w-100" href="#" role="button">View</a>
								</div>
							{% endif %}
						</div>

						<!-- Ensure that no action can be taken on ones self. -->
						{% if participant.profile.user is user %}
							{% if match_is_in_past %}

								<!-- Match is in the past, the player can only be reported. -->
								<div class="row text-center mt-2">
									<div class="col">
										<a class="btn btn-danger w-100" href="{% url 'kitup:match_report' participant.id %}" role="button">Report</a>
									</div>
								</div>

							{% else %}
								{% if user_is_owner %}

									<!-- Match is not in the past, and the owner can kick the player. -->
									<div class="row text-center mt-2">
										<div class="col"><a class="btn btn-danger w-100" href="{% url 'kitup:match_kick' participant.id %}" role="button">Kick</a></div>
									</div>

								{% endif %}
							{% endif %}
						{% endif %}

					{% endif %}

				</div>
			</div>
		</div>

		<!-- Process rows. -->
		{% if forloop.last %}
			</div>
		{% else %}
			{% if forloop.counter|divisibleby:"4" %}</div><div class="row">{% endif %}
		{% endif %}

	{% endfor %}

</div>

{% endblock %}